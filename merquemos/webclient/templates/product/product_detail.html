{% extends 'webclient/base.html' %}
{% load static %}
{% load humanize %}

{% block content%}
<div id="primary" class="content-area">
    <main id="main" class="site-main">

        <div class="product">

            <div class="single-product-wrapper">
                <div class="product-images-wrapper">
                    <div class="images electro-gallery">
                        <img src="{{product.get_image_url}}" class="wp-post-image" alt="">
                    </div><!-- .electro-gallery -->
                </div><!-- /.product-images-wrapper -->

                <div class="summary entry-summary">

                    <span class="loop-product-categories">
                        <a rel="tag">{{product.categoy.name}}</a>
                    </span><!-- /.loop-product-categories -->

                    <h1 itemprop="name" class="product_title entry-title">{{product.name}}</h1>

                    <hr class="single-product-title-divider" />

                    <div itemprop="description">
                        <p>{{product.description}}</p>
                        <p><strong>SKU</strong>: {{product.sku}}</p>
                        <p><strong>Presentaci√≥n</strong>: {{product.size}}</p>
                    </div><!-- .description -->

                    <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">

                        <p class="price"><span class="electro-price">
                        <ins><h4 class="amount">&#36;{{product.get_price|intcomma}}</h4></ins> 
                        {% if product.has_discount %}
                        <del><span class="amount">&#36;{{product.price|intcomma}}</span></del></span></p>
                        {% endif %}
                        <meta itemprop="price" content="{{product.price|intcomma}}" />
                        <meta itemprop="priceCurrency" content="COP" />
                        <link itemprop="availability" href="http://schema.org/InStock" />

                    </div><!-- /itemprop -->

                    <form class="variations_form cart" method="POST" id="add_to_cart_form">

                        <div class="single_variation_wrap">
                            <div class="woocommerce-variation single_variation"></div>
                            <div class="woocommerce-variation-add-to-cart variations_button">
                                    <div class="quantity">
                                        <label>Cantidad:</label>
                                        <input type="number" name="quantity" value="1" title="Qty" class="input-text qty text quantity_selector"/>
                                    </div>
                                    <button type="submit" class="single_add_to_cart_button button">Agregar al carrito</button>
                                    <input type="hidden" name="product" value="{{product.pk}}" />
                            </div>
                        </div>
                    </form>

                </div><!-- .summary -->
            </div><!-- /.single-product-wrapper -->
        </div><!-- /.product -->

    </main><!-- /.site-main -->
</div><!-- /.content-area -->
{% endblock %}

{% block extra_js %}
    <script>
        (function($) {
            $('#add_to_cart_form').on('submit', function(e) {
                {% if not request.user.is_authenticated %}
                    window.location.reload("{% url 'webclient:login' %}");
                {% endif %}
                e.preventDefault();
                var jqxhr = $.post( "{% url 'sales:item-create' %}", $(this).serialize(), function(data) {
                    update_cart();
                    toastr.success('Producto agregado exitosamente');
                });
            });
        })(jQuery);
    </script>
{% endblock %}