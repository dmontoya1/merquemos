{% load i18n %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

<style>
    /* .select2-selection__rendered {
        display: none !important;
    }
    .select2.select2-container.select2-container--default {
        width: 100% !important;
    } */
    a, a:visited, a:hover, a:focus {
        color: #47bac1;
        font-weight: normal;
        text-decoration: none;
    }
</style>

<ul>
    <li class="contrast">
        <a href="#" title="Reportes">Reportes</a>
    </li>
    <li>
        <a href="#" data-toggle="modal" data-target="#register_products">
            Productos realizados
        </a>
    </li>
    <li>
        <a href="#" data-toggle="modal" data-target="#number_services">
            Número de servicios por establecimiento
        </a>
    </li>
    <li>
        <a href="#" data-toggle="modal" data-target="#rating">
            Calificaciones de la plataforma
        </a>
    </li>
    <li>
        <a href="#" data-toggle="modal" data-target="#sales">
            Ventas realizadas
        </a>
    </li>
    <li>
        <a href="#" data-toggle="modal" data-target="#requests">
            Solicitudes realizadas
        </a>
    </li>
</ul>

<div class="modal fade" id="register_products" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reporte de  productos realizados a través de la plataforma</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="/admin/reports/">
                    <input type="hidden" name="report" value="number_services" />
                    {% csrf_token %}
                        
                    <h6>Fechas</h6>
                    <div class="input-daterange input-group" >
                        <input type="date" class="input-sm form-control" name="start" />
                        <span class="input-group-addon">hasta</span>
                        <input type="date" class="input-sm form-control" name="end" />
                    </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" type="submit">Generar</a>
            </div>
                </form>
        </div>
    </div>
</div>

<div class="modal fade" id="number_services" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reporte de número de servicios prestados por un establecimiento</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="/admin/reports/">
                    <input type="hidden" name="report" value="register_products" />
                    {% csrf_token %}
                        
                    <h6>Fechas</h6>
                    <div class="input-daterange input-group" >
                        <input type="date" class="input-sm form-control" name="start" required/>
                        <span class="input-group-addon">hasta</span>
                        <input type="date" class="input-sm form-control" name="end" required/>
                    </div>
                    <select class="select2" name="store" class="browser-default" required>
                        <option disabled selected value="">Seleccione un establecimiento</option>
                        {% for store in stores %}
                            <option value="{{store.pk}}">{{store.name}}</option>
                        {% endfor %}
                    </select>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" type="submit">Generar</a>
            </div>
                </form>
        </div>
    </div>
</div>

<div class="modal fade" id="rating" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reporte de calificaciones de la plataforma</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="/admin/reports/">
                    <input type="hidden" name="report" value="rating" />
                    {% csrf_token %}
                        
                    <h6>Fechas</h6>
                    <div class="input-daterange input-group" >
                        <input type="date" class="input-sm form-control" name="start" required/>
                        <span class="input-group-addon">hasta</span>
                        <input type="date" class="input-sm form-control" name="end" required/>
                    </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" type="submit">Generar</a>
            </div>
                </form>
        </div>
    </div>
</div>

<div class="modal fade" id="sales" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reporte de ventas realizadas a través de la plataforma de un establecimiento</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="/admin/reports/">
                    <input type="hidden" name="report" value="sales" />
                    {% csrf_token %}
                        
                    <h6>Departamento</h6>
                    <select name="state" class="browser-default state-select-sales" required>
                        <option disabled selected value="">Seleccione un departamento</option>
                        {% for state in states %}
                            <option value="{{state.pk}}">{{state.name}}</option>
                        {% endfor %}
                    </select>
                    <h6>Ciudad</h6>
                    <select name="city" class="browser-default city-select-sales" required>
                        <option disabled selected value="">Seleccione primero un departamento</option>
                    </select>
                    <h6>Establecimiento</h6>
                    <select name="store" class="browser-default store-select-sales" required>
                        <option disabled selected value="">Seleccione primero la ciudad</option>
                    </select>
                    <h6>Fechas</h6>
                    <div class="input-daterange input-group" >
                        <input type="date" class="input-sm form-control" name="start" required/>
                        <span class="input-group-addon">hasta</span>
                        <input type="date" class="input-sm form-control" name="end" required/>
                    </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" type="submit">Generar</a>
            </div>
                </form>
        </div>
    </div>
</div>

<div class="modal fade" id="requests" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reporte de calificaciones de la plataforma</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="/admin/reports/">
                    <input type="hidden" name="report" value="requests" />
                    {% csrf_token %}
                        
                    <h6>Departamento</h6>
                    <select name="state" class="browser-default state-select-request" required>
                        <option disabled selected value="">Seleccione un departamento</option>
                        {% for state in states %}
                            <option value="{{state.pk}}">{{state.name}}</option>
                        {% endfor %}
                    </select>
                    <h6>Ciudad</h6>
                    <select name="city" class="browser-default city-select-request" required>
                        <option disabled selected value="">Seleccione primero un departamento</option>
                    </select>
                    <h6>Establecimiento</h6>
                    <select name="store" class="browser-default store-select-request" required>
                        <option disabled selected value="">Seleccione primero la ciudad</option>
                    </select>
                    <h6>Fechas</h6>
                    <div class="input-daterange input-group" >
                        <input type="date" class="input-sm form-control" name="start" required/>
                        <span class="input-group-addon">hasta</span>
                        <input type="date" class="input-sm form-control" name="end" required/>
                    </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" type="submit">Generar</a>
            </div>
                </form>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    $(document).ready(function() {
        axios.defaults.headers.common['Api-Key'] = '{{webclient_context_web_auth_token.key}}';
    });
    $('.state-select-sales').on('change', function(){
            axios.get('/api/manager/cities', {
                params: {
                    state_id: $(this).val()
                }
            })
            .then(function (response) {
                data = response.data
                $('.city-select-sales').empty()
                $.each( data, function( k, v ) {
                    $('.city-select-sales').append(
                        `<option value=${v.id}>${v.name}</option>`
                    )
                });
                $('.city-select-sales').prepend(
                    `<option selected disabled>Selecciona una ciudad</option>`
                )
            })
            .catch(function (error) {
                console.log(error);
            })
        })

        $('.city-select-sales').on('change', function(){
            axios.get('/api/stock/stores', {
                params: {
                    city_id: $(this).val()
                }
            })
            .then(function (response) {
                data = response.data
                $('.store-select-sales').empty()
                $.each( data, function( k, v ) {
                    $('.store-select-sales').append(
                        `<option value=${v.pk}>${v.name}</option>`
                    )
                });
                $('.store-select-sales').prepend(
                    `<option selected disabled>Selecciona un establecimiento</option>`
                )
            })
            .catch(function (error) {
                console.log(error);
            })
        })

        $('.state-select-request').on('change', function(){
            axios.get('/api/manager/cities', {
                params: {
                    state_id: $(this).val()
                }
            })
            .then(function (response) {
                data = response.data
                $('.city-select-request').empty()
                $.each( data, function( k, v ) {
                    $('.city-select-request').append(
                        `<option value=${v.id}>${v.name}</option>`
                    )
                });
                $('.city-select-request').prepend(
                    `<option selected disabled>Selecciona una ciudad</option>`
                )
            })
            .catch(function (error) {
                console.log(error);
            })
        })

        $('.city-select-request').on('change', function(){
            axios.get('/api/stock/stores', {
                params: {
                    city_id: $(this).val()
                }
            })
            .then(function (response) {
                data = response.data
                console.log(data)
                $('.store-select-request').empty()
                $.each( data, function( k, v ) {
                    $('.store-select-request').append(
                        `<option value=${v.pk}>${v.name}</option>`
                    )
                });
                $('.store-select-request').prepend(
                    `<option selected disabled>Selecciona un establecimiento</option>`
                )
            })
            .catch(function (error) {
                console.log(error);
            })
        })
</script>